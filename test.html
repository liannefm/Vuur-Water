<!DOCTYPE html>
<html lang="nl">

<head>
    <meta charset="UTF-8">
    <title>Firegirl & Waterman Level Editor</title>

    <style>
        body {
            margin: 0;
            font-family: Arial, sans-serif;
            display: flex;
            height: 100vh;
        }

        /* ===== TOOLBAR ===== */
        #toolbar {
            width: 260px;
            background: #222;
            color: white;
            padding: 10px;
        }

        button {
            width: 100%;
            padding: 8px;
            margin-bottom: 6px;
            border: none;
            cursor: pointer;
            color: white;
        }

        .fire {
            background: red;
        }

        .water {
            background: blue;
        }

        .wall {
            background: gray;
        }

        .spawn-fire {
            background: darkred;
        }

        .spawn-water {
            background: darkblue;
        }

        #placeBtn {
            background: green;
        }

        #deleteBtn {
            background: darkred;
        }

        #saveBtn {
            background: #444;
        }

        /* ===== VIEWPORT ===== */
        #viewport {
            flex: 1;
            overflow: scroll;
            background: #bbb;
        }

        /* ===== WORLD ===== */
        #world {
            position: relative;
            width: 5000px;
            height: 5000px;
            background-image:
                linear-gradient(to right, #ccc 1px, transparent 1px),
                linear-gradient(to top, #ccc 1px, transparent 1px);
            background-size: 50px 50px;
        }

        /* ===== BLOKKEN ===== */
        .block {
            position: absolute;
            cursor: move;
        }

        .selected {
            outline: 2px dashed yellow;
        }

        /* ===== SPAWNS ===== */
        .spawn {
            position: absolute;
            width: 40px;
            height: 60px;
            cursor: move;
            border: 2px solid white;
        }

        .spawn.fire {
            background: red;
        }

        .spawn.water {
            background: blue;
        }

        /* ===== RESIZE HANDLES ===== */
        .handle {
            width: 10px;
            height: 10px;
            background: white;
            border: 1px solid black;
            position: absolute;
        }

        .handle.right {
            right: -6px;
            top: 50%;
            transform: translateY(-50%);
            cursor: ew-resize;
        }

        .handle.top {
            top: -6px;
            left: 50%;
            transform: translateX(-50%);
            cursor: ns-resize;
        }

        .handle.corner {
            right: -6px;
            top: -6px;
            cursor: nwse-resize;
        }
    </style>
</head>

<body>

    <!-- ===== TOOLBAR ===== -->
    <div id="toolbar">
        <h4>Blokken</h4>
        <button class="fire" onclick="setType('fire')">Fire blok</button>
        <button class="water" onclick="setType('water')">Water blok</button>
        <button class="wall" onclick="setType('wall')">blok</button>

        <h4>Spawns</h4>
        <button class="spawn-fire" onclick="placeSpawn('fire')">üî• Firegirl spawn</button>
        <button class="spawn-water" onclick="placeSpawn('water')">üíß Watergirl spawn</button>

        <button id="placeBtn">‚ûï Plaats blok</button>
        <button id="deleteBtn">‚ùå Verwijder geselecteerde</button>
        <button id="saveBtn">üíæ Save level</button>
    </div>

    <!-- ===== VIEWPORT / WORLD ===== -->
    <div id="viewport">
        <div id="world"></div>
    </div>

    <script>
        /* ===== VARIABELEN ===== */
        let currentType = null;
        let selected = null;
        let action = null;
        let startX, startY, startW, startH, startL, startB;

        const world = document.getElementById("world");
        const viewport = document.getElementById("viewport");

        let fireSpawn = null;
        let waterSpawn = null;

        /* Start links-onder */
        viewport.scrollLeft = 0;
        viewport.scrollTop = world.offsetHeight;

        /* ===== TYPE ===== */
        function setType(type) {
            currentType = type;
        }

        /* ===== BLOK PLAATSEN ===== */
        document.getElementById("placeBtn").onclick = () => {
            if (!currentType) return alert("Kies eerst een bloktype");

            const block = document.createElement("div");
            block.className = "block " + currentType;
            block.style.width = "60px";
            block.style.height = "60px";
            block.style.left = "0px";
            block.style.bottom = "0px";

            addHandles(block);
            world.appendChild(block);
            select(block);
        };

        /* ===== SPAWN PLAATSEN ===== */
        function placeSpawn(type) {
            if (type === "fire" && fireSpawn) fireSpawn.remove();
            if (type === "water" && waterSpawn) waterSpawn.remove();

            const spawn = document.createElement("div");
            spawn.className = "spawn " + type;
            spawn.style.left = "0px";
            spawn.style.bottom = "0px";

            spawn.addEventListener("mousedown", e => {
                action = "move";
                select(spawn);
                startX = e.clientX;
                startY = e.clientY;
                startL = spawn.offsetLeft;
                startB = parseInt(spawn.style.bottom);
            });

            spawn.addEventListener("click", e => {
                e.stopPropagation();
                select(spawn);
            });

            world.appendChild(spawn);

            if (type === "fire") fireSpawn = spawn;
            if (type === "water") waterSpawn = spawn;

            select(spawn);
        }

        /* ===== HANDLES ===== */
        function addHandles(block) {
            ["right", "top", "corner"].forEach(type => {
                const h = document.createElement("div");
                h.className = "handle " + type;
                block.appendChild(h);

                h.addEventListener("mousedown", e => {
                    e.stopPropagation();
                    action = type;
                    select(block);
                    startX = e.clientX;
                    startY = e.clientY;
                    startW = block.offsetWidth;
                    startH = block.offsetHeight;
                });
            });

            block.addEventListener("mousedown", e => {
                if (e.target.classList.contains("handle")) return;
                action = "move";
                select(block);
                startX = e.clientX;
                startY = e.clientY;
                startL = block.offsetLeft;
                startB = parseInt(block.style.bottom);
            });

            block.addEventListener("click", e => {
                e.stopPropagation();
                select(block);
            });
        }

        /* ===== MOUSE MOVE ===== */
        document.addEventListener("mousemove", e => {
            if (!action || !selected) return;

            const dx = e.clientX - startX;
            const dy = e.clientY - startY;

            if (action === "move") {
                selected.style.left = startL + dx + "px";
                selected.style.bottom = startB - dy + "px";
            }

            if (action === "right") {
                selected.style.width = Math.max(20, startW + dx) + "px";
            }

            if (action === "top") {
                selected.style.height = Math.max(20, startH - dy) + "px";
            }

            if (action === "corner") {
                selected.style.width = Math.max(20, startW + dx) + "px";
                selected.style.height = Math.max(20, startH - dy) + "px";
            }
        });

        /* ===== STOP ===== */
        document.addEventListener("mouseup", () => action = null);

        /* ===== SELECT ===== */
        function select(el) {
            document.querySelectorAll(".selected").forEach(e => e.classList.remove("selected"));
            selected = el;
            el.classList.add("selected");
        }

        /* ===== DELETE ===== */
        document.getElementById("deleteBtn").onclick = () => {
            if (!selected) return;

            if (selected === fireSpawn) fireSpawn = null;
            if (selected === waterSpawn) waterSpawn = null;

            selected.remove();
            selected = null;
        };

        /* ===== SAVE ===== */
        document.getElementById("saveBtn").onclick = () => {
            if (!fireSpawn || !waterSpawn) {
                alert("Je moet BOTH Firegirl en Waterman spawn plaatsen!");
                return;
            }

            const blocks = [];

            document.querySelectorAll(".block").forEach(b => {
                let type = b.classList.contains("fire") ? "fire" :
                    b.classList.contains("water") ? "water" : "block";

                blocks.push({
                    type,
                    x: b.offsetLeft,
                    y: parseInt(b.style.bottom),
                    width: b.offsetWidth,
                    height: b.offsetHeight
                });
            });

            const level = {
                fireSpawn: {
                    x: fireSpawn.offsetLeft,
                    y: parseInt(fireSpawn.style.bottom)
                },
                waterSpawn: {
                    x: waterSpawn.offsetLeft,
                    y: parseInt(waterSpawn.style.bottom)
                },
                blocks
            };

            console.clear();
            console.log("LEVEL DATA:");
            console.log(JSON.stringify(level, null, 2));
        };
    </script>

</body>

</html>